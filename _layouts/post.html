---
layout: default
---

<a href="{{ site.baseurl }}/" class="back">‚Üê Trang ch·ªß</a>

<div class="post-header">
    <h1>{{ page.title }}</h1>
    {% if page.title_en %}
    <div class="lang-toggle">
        <button class="lang-btn active" data-lang="vi">VI</button>
        <button class="lang-btn" data-lang="en">EN</button>
    </div>
    {% endif %}
</div>

<div class="meta">
    <time class="date" datetime="{{ page.date | date: "%Y-%m-%d" }}">{{ page.date | date: "%d/%m/%Y" }}</time>
    <span class="reading-time">‚Ä¢ {{ content | number_of_words | divided_by: 200 | ceil }} ph√∫t ƒë·ªçc</span>
</div>

<article class="post-content">
    <div class="lang-content lang-vi">
        {{ content }}
    </div>
    {% if page.content_en %}
    <div class="lang-content lang-en" style="display: none;">
        {{ page.content_en }}
    </div>
    {% endif %}
</article>

<!-- AI Search Modal -->
<div class="ai-modal-overlay" id="aiModal">
    <div class="ai-modal">
        <div class="ai-modal-header">
            <span>üîç AI Insights</span>
            <button class="ai-modal-close" id="aiModalCloseBtn">√ó</button>
        </div>
        <div class="ai-modal-body" id="aiModalBody">
            <p class="ai-loading">üîÑ ƒêang t√¨m ki·∫øm...</p>
        </div>
        <div class="ai-modal-footer">
            <a href="#" id="aiSearchLink" target="_blank">T√¨m tr√™n Google ‚Üí</a>
        </div>
    </div>
</div>

<style>
.post-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
}
.post-header h1 { flex: 1; }
.lang-toggle { display: flex; gap: 4px; opacity: 0.6; transition: opacity 0.3s; }
.lang-toggle:hover { opacity: 1; }
.lang-btn {
    background: var(--border);
    border: none;
    padding: 4px 10px;
    font-size: 0.7rem;
    cursor: pointer;
    border-radius: 4px;
    color: var(--text-muted);
    transition: all 0.3s;
}
.lang-btn.active { background: var(--text); color: var(--bg); }

/* AI Modal - Glassmorphism */
.ai-modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 20000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}
.ai-modal-overlay.show { display: flex; }
.ai-modal {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 16px;
    width: 90%;
    max-width: 420px;
    box-shadow: 0 25px 80px rgba(0,0,0,0.5);
    animation: aiModalFadeIn 0.3s ease;
}
@keyframes aiModalFadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
.ai-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 18px 24px;
    border-bottom: 1px solid var(--border);
    font-size: 0.95rem;
    font-family: var(--font-sans);
}
.ai-modal-close {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 1.8rem;
    cursor: pointer;
    line-height: 1;
    padding: 0;
}
.ai-modal-body {
    padding: 24px;
    font-size: 1rem;
    line-height: 1.75;
    min-height: 120px;
    font-family: var(--font-body);
}
.ai-modal-body strong {
    font-family: var(--font-display);
    font-size: 1.15rem;
    display: block;
    margin-bottom: 8px;
}
.ai-loading { opacity: 0.6; font-style: italic; }
.ai-modal-footer {
    padding: 14px 24px;
    border-top: 1px solid var(--border);
    text-align: right;
}
.ai-modal-footer a {
    color: var(--accent);
    text-decoration: none;
    font-size: 0.85rem;
    font-family: var(--font-sans);
}

/* AI Trigger Button */
.ai-search-trigger {
    display: none;
    position: absolute;
    background: var(--text);
    color: var(--bg);
    border: none;
    border-radius: 20px;
    padding: 6px 14px;
    font-size: 0.75rem;
    cursor: pointer;
    box-shadow: 0 4px 16px rgba(0,0,0,0.35);
    z-index: 15000;
    font-family: var(--font-sans);
    white-space: nowrap;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Language Toggle
    var langBtns = document.querySelectorAll('.lang-btn');
    langBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
            var lang = this.dataset.lang;
            langBtns.forEach(function(b) { b.classList.remove('active'); });
            this.classList.add('active');
            document.querySelectorAll('.lang-content').forEach(function(c) { c.style.display = 'none'; });
            document.querySelector('.lang-' + lang).style.display = 'block';
        });
    });
    
    // AI Search - Fixed Selection
    var aiTrigger = null;
    var lastSelectedText = '';
    
    document.addEventListener('selectionchange', function() {
        setTimeout(function() {
            var selection = window.getSelection();
            var selectedText = selection.toString().trim();
            
            // Only show if selection changed and valid
            if (selectedText !== lastSelectedText && selectedText.length > 2 && selectedText.length < 80) {
                lastSelectedText = selectedText;
                
                try {
                    var range = selection.getRangeAt(0);
                    var rect = range.getBoundingClientRect();
                    
                    if (!aiTrigger) {
                        aiTrigger = document.createElement('button');
                        aiTrigger.className = 'ai-search-trigger';
                        aiTrigger.textContent = 'üîç AI';
                        document.body.appendChild(aiTrigger);
                    }
                    
                    aiTrigger.style.display = 'block';
                    aiTrigger.style.top = (rect.bottom + window.scrollY + 10) + 'px';
                    aiTrigger.style.left = Math.min(rect.left + window.scrollX, window.innerWidth - 120) + 'px';
                    
                    // Update click handler with current selection
                    aiTrigger.onclick = function() { searchAI(lastSelectedText); };
                } catch(e) {}
            } else if (selectedText.length <= 2) {
                lastSelectedText = '';
                if (aiTrigger) aiTrigger.style.display = 'none';
            }
        }, 100);
    });
    
    // Close modal handlers
    document.getElementById('aiModalCloseBtn').addEventListener('click', closeAIModal);
    document.getElementById('aiModal').addEventListener('click', function(e) {
        if (e.target === this) closeAIModal();
    });
});

function searchAI(query) {
    var modal = document.getElementById('aiModal');
    var body = document.getElementById('aiModalBody');
    var link = document.getElementById('aiSearchLink');
    
    modal.classList.add('show');
    body.innerHTML = '<p class="ai-loading">üîÑ ƒêang t√¨m ki·∫øm v·ªÅ "' + query + '"...</p>';
    
    // Update Google link
    link.href = 'https://www.google.com/search?q=' + encodeURIComponent(query);
    
    // Fetch from Wikipedia API
    fetch('https://en.wikipedia.org/api/rest_v1/page/summary/' + encodeURIComponent(query.replace(/ /g, '_')))
        .then(function(response) {
            if (!response.ok) throw new Error('Not found');
            return response.json();
        })
        .then(function(data) {
            if (data.extract) {
                body.innerHTML = '<strong>' + data.title + '</strong><p style="margin-top:12px;opacity:0.85">' + data.extract.substring(0, 350) + '</p>';
            } else {
                body.innerHTML = '<p>Kh√¥ng t√¨m th·∫•y th√¥ng tin. B·∫•m link b√™n d∆∞·ªõi ƒë·ªÉ t√¨m tr√™n Google.</p>';
            }
        })
        .catch(function(e) {
            body.innerHTML = '<p style="font-style:italic;opacity:0.6">ƒêang ph√¢n t√≠ch s√¢u h∆°n v·ªÅ "' + query + '"...</p><p style="margin-top:12px;opacity:0.7">B·∫•m link b√™n d∆∞·ªõi ƒë·ªÉ t√¨m th√™m th√¥ng tin.</p>';
        });
}

function closeAIModal() {
    document.getElementById('aiModal').classList.remove('show');
}
</script>
