<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Tri·∫øt H·ªçc M·ªói Ng√†y</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0A0A0A; --text: #E0E0E0; --text-muted: #888; --accent: #1A1A1A; --border: #333; --primary: #E0E0E0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 40px 20px; }
        .container { max-width: 700px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
        .header h1 { font-size: 1.5rem; font-weight: 400; }
        .logout { color: var(--text-muted); text-decoration: none; font-size: 0.85rem; cursor: pointer; }
        .form-group { margin-bottom: 24px; }
        label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.85rem; }
        input, textarea { width: 100%; padding: 14px; background: var(--accent); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: inherit; font-size: 1rem; }
        input:focus, textarea:focus { outline: none; border-color: var(--primary); }
        textarea { min-height: 300px; line-height: 1.6; resize: vertical; }
        .btn { padding: 14px 28px; background: var(--primary); color: var(--bg); border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .token-group { background: var(--accent); padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .token-group h3 { font-size: 1rem; margin-bottom: 12px; }
        .token-group p { color: var(--text-muted); font-size: 0.8rem; margin-bottom: 12px; }
        .token-group a { color: #60a5fa; }
        .status { margin-top: 20px; padding: 16px; border-radius: 8px; display: none; }
        .status.success { background: #064e3b; color: #6ee7b7; display: block; }
        .status.error { background: #450a0a; color: #fca5a5; display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚úçÔ∏è Vi·∫øt b√†i m·ªõi</h1>
            <a href="{{ site.baseurl }}/" class="logout">‚Üê V·ªÅ trang ch·ªß</a>
        </div>
        
        <div class="token-group">
            <h3>üîë GitHub Token</h3>
            <p>C·∫ßn token c√≥ quy·ªÅn <code>repo</code>. <a href="https://github.com/settings/tokens" target="_blank">T·∫°o t·∫°i ƒë√¢y</a></p>
            <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
            <button onclick="saveToken()" style="margin-top:10px;padding:8px 16px;background:#333;color:#fff;border:none;border-radius:4px;cursor:pointer;">üíæ L∆∞u Token</button>
        </div>
        
        <div class="form-group">
            <label>Ti√™u ƒë·ªÅ b√†i vi·∫øt</label>
            <input type="text" id="title" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ...">
        </div>
        
        <div class="form-group">
            <label>M√¥ t·∫£ ng·∫Øn (description)</label>
            <input type="text" id="description" placeholder="M·ªôt ho·∫∑c hai c√¢u...">
        </div>
        
        <div class="form-group">
            <label>N·ªôi dung b√†i vi·∫øt (Markdown)</label>
            <textarea id="content" placeholder="Vi·∫øt n·ªôi dung b√†i vi·∫øt ·ªü ƒë√¢y..."></textarea>
        </div>
        
        <button class="btn" id="btnPublish" onclick="publishPost()">üì§ ƒêƒÉng b√†i l√™n web</button>
        
        <div id="status" class="status"></div>
    </div>

    <script>
        // Load saved token
        const savedToken = localStorage.getItem('github_token');
        if (savedToken) document.getElementById('githubToken').value = savedToken;
        
        function saveToken() {
            const token = document.getElementById('githubToken').value.trim();
            if (token) {
                localStorage.setItem('github_token', token);
                alert('‚úÖ ƒê√£ l∆∞u token!');
            }
        }
        
        async function publishPost() {
            const token = localStorage.getItem('github_token');
            if (!token) {
                alert('‚ùå Vui l√≤ng nh·∫≠p v√† l∆∞u GitHub Token tr∆∞·ªõc!');
                return;
            }
            
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const content = document.getElementById('content').value.trim();
            
            if (!title || !content) {
                alert('‚ùå Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ v√† n·ªôi dung!');
                return;
            }
            
            const btn = document.getElementById('btnPublish');
            btn.disabled = true;
            btn.innerText = '‚è≥ ƒêang ƒëƒÉng...';
            
            // Generate slug from title
            const slug = title.toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/(^-|-$)/g, '');
            
            // Get current date from browser (YYYY-MM-DD)
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;
            
            // FILENAME: YYYY-MM-DD-slug.md (Jekyll standard)
            const filename = `_posts/${dateStr}-${slug}.md`;
            
            // Build Jekyll content
            const jekyllContent = `---
layout: post
title: "${title}"
date: ${dateStr}
description: "${description}"
---

${content}
`;
            
            const REPO_OWNER = 'canneed02';
            const REPO_NAME = 'triet-hoc-moi-ngay';
            const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filename}`;
            
            // Encode to base64
            const encodedContent = btoa(unescape(encodeURIComponent(jekyllContent)));
            
            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Th√™m b√†i: ${title}`,
                        content: encodedContent
                    })
                });
                
                const statusDiv = document.getElementById('status');
                
                if (response.ok) {
                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = `‚úÖ ƒêƒÉng b√†i th√†nh c√¥ng!<br>B√†i vi·∫øt s·∫Ω xu·∫•t hi·ªán sau 1-2 ph√∫t khi GitHub Pages build xong.`;
                    document.getElementById('title').value = '';
                    document.getElementById('description').value = '';
                    document.getElementById('content').value = '';
                } else {
                    const errorData = await response.json();
                    statusDiv.className = 'status error';
                    statusDiv.innerHTML = `‚ùå L·ªói: ${errorData.message}`;
                }
            } catch (error) {
                const statusDiv = document.getElementById('status');
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `‚ùå L·ªói m·∫°ng: ${error}`;
            }
            
            btn.disabled = false;
            btn.innerText = 'üì§ ƒêƒÉng b√†i l√™n web';
        }
    </script>
</body>
</html>
